apiVersion: v1
kind: ConfigMap
metadata:
  name: librechat-config
  namespace: default
data:
  librechat.yaml: |
    # For more information, see the Configuration Guide:
    # https://www.librechat.ai/docs/configuration/librechat_yaml/example

    # Configuration version (required)
    version: 1.2.1

    # Cache settings: Set to true to enable caching
    cache: true

    # File strategy s3/firebase
    # fileStrategy: "s3"

    # Custom interface configuration
    interface:
      customWelcome: "Hey {{user.name}}! Welcome to cBioAgent (WIP ⚠️)."
      # MCP Servers UI configuration
      mcpServers:
        placeholder: 'MCP Servers'
      # Privacy policy settings
      privacyPolicy:
        externalUrl: 'https://librechat.ai/privacy-policy'
        openNewTab: true

      # Terms of service
      termsOfService:
        externalUrl: 'https://librechat.ai/tos'
        openNewTab: true
        modalAcceptance: true
        modalTitle: "Terms of Service for LibreChat"
        modalContent: |
          # Terms and Conditions for LibreChat

          *Effective Date: February 18, 2024*

          Welcome to LibreChat, the informational website for the open-source AI chat platform, available at https://librechat.ai. These Terms of Service ("Terms") govern your use of our website and the services we offer. By accessing or using the Website, you agree to be bound by these Terms and our Privacy Policy, accessible at https://librechat.ai//privacy.

          ## 1. Ownership

          Upon purchasing a package from LibreChat, you are granted the right to download and use the code for accessing an admin panel for LibreChat. While you own the downloaded code, you are expressly prohibited from reselling, redistributing, or otherwise transferring the code to third parties without explicit permission from LibreChat.

          ## 2. User Data

          We collect personal data, such as your name, email address, and payment information, as described in our Privacy Policy. This information is collected to provide and improve our services, process transactions, and communicate with you.

          ## 3. Non-Personal Data Collection

          The Website uses cookies to enhance user experience, analyze site usage, and facilitate certain functionalities. By using the Website, you consent to the use of cookies in accordance with our Privacy Policy.

          ## 4. Use of the Website

          You agree to use the Website only for lawful purposes and in a manner that does not infringe the rights of, restrict, or inhibit anyone else's use and enjoyment of the Website. Prohibited behavior includes harassing or causing distress or inconvenience to any person, transmitting obscene or offensive content, or disrupting the normal flow of dialogue within the Website.

          ## 5. Governing Law

          These Terms shall be governed by and construed in accordance with the laws of the United States, without giving effect to any principles of conflicts of law.

          ## 6. Changes to the Terms

          We reserve the right to modify these Terms at any time. We will notify users of any changes by email. Your continued use of the Website after such changes have been notified will constitute your consent to such changes.

          ## 7. Contact Information

          If you have any questions about these Terms, please contact us at contact@librechat.ai.

          By using the Website, you acknowledge that you have read these Terms of Service and agree to be bound by them.

      endpointsMenu: true
      modelSelect: false
      parameters: false
      sidePanel: true
      presets: false
      prompts: false
      bookmarks: false
      multiConvo: false
      agents: true
      runCode: false
      webSearch: false

    # Example Registration Object Structure (optional)
    registration:
      socialLogins: ['github', 'google', 'discord', 'openid', 'facebook', 'apple', 'saml']
      # allowedDomains:
      # - "gmail.com"

    # Example Actions Object Structure
    actions:
      allowedDomains:
        - "swapi.dev"
        - "librechat.ai"
        - "google.com"

    # MCP Servers Object Structure
    mcpServers:
      cbioportal-database:
        type: streamable-http
        url: http://cbioagent-clickhouse-mcp:80/mcp
      cbioportal-navigator:
        type: streamable-http
        url: http://cbioportal-navigator:80/mcp
        chatMenu: false

    # Definition of endpoints
    endpoints:
      agents:
        recursionLimit: 50
        maxRecursionLimit: 100
        disableBuilder: false
      assistants:
        disableBuilder: true

    # File uploading configuration
    fileConfig:
      endpoints:
        anthropic:
          disabled: true

    # Token limits
    balance:
      enabled: true
      startBalance: 20000000
      autoRefillEnabled: true
      refillIntervalValue: 7
      refillIntervalUnit: "days"
      refillAmount: 20000000

    # Model spec
    modelSpecs:
      enforce: false
      prioritize: true
      list:
        - name: "cBioDBAgent"
          label: "cBioDBAgent - Talk to cBioPortal Database"
          description: "An AI assistant for querying and exploring cBioPortal database."
          iconURL: "https://raw.githubusercontent.com/cBioPortal/cbioportal/refs/heads/master/src/main/resources/webapp/images/cbioportal_icon.png"
          showIconInHeader: true
          showIconInMenu: true
          preset:
            endpoint: "agents"
            agent_id: "agent_4QP14nOYaCTkqK8E3Nopg"
            maxTokens: 4096
            thinking: false
            temperature: 0
            modelLabel: "cBioDBAgent"
            greeting: |
              Ask questions below to explore the cBioPortal database, including studies, genes, mutations, and clinical attributes. NOTE: Limit of 20 messages per 30 minutes, and 20M tokens per week. <br /><br /><a href="https://docs.cbioportal.org/ai-integrations/chat-interface/" target="_blank" style="display: inline-block; background-color: #4b5563; color: #f9fafb; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 15px; transition: background-color 0.2s ease;" onmouseover="this.style.backgroundColor='#374151'" onmouseout="this.style.backgroundColor='#4b5563'">Learn more</a>
            promptPrefix: |
              # cBioPortal MCP Assistant

              You are a helpful assistant with access to cBioPortal cancer genomics data through MCP tools. Your role is to provide structured, reliable answers using the ClickHouse database behind cBioPortal.

              ## Resource Reading Requirements

              BEFORE ANSWERING ANY QUESTION, you MUST:
              1. Call `list_mcp_resources()` to see available guides
              2. Call `read_mcp_resource(uri)` to read the relevant guide(s) for the query type:
                 - Mutation frequency questions: read `cbioportal://mutation-frequency-guide`
                 - Clinical data questions: read `cbioportal://clinical-data-guide`
                 - Sample/study filtering: read `cbioportal://sample-filtering-guide`
                 - Treatment questions: read `cbioportal://treatment-guide`
                 - General cBioPortal questions (history, features, data types, how to cite): read `cbioportal://faq-guide`
                 - When unsure: read `cbioportal://common-pitfalls`
              3. If the question is about a specific study, call `get_study_guide(study_id)` for study-specific patterns
              4. Follow the patterns from those guides when constructing queries

              ## Study Discovery

              - For questions about finding/counting studies: MUST read `cbioportal://clinical-data-guide` first (contains abbreviations, OncoTree codes, and multi-field search patterns)
              - Cancer types have abbreviations (e.g. Glioblastoma = GBM, glioma) and OncoTree codes — you must search all of them
              - Use `list_studies(search)` for initial discovery, but ALSO search with abbreviations and run SQL with `cancer_study_identifier` and `type_of_cancer_id`
              - Do NOT hardcode study filters unless the question explicitly names a study
              - Questions may span multiple studies or all of cBioPortal

              ## Quick Schema Reference

              Use the guides for full details; this is a quick reminder:
              - Prefer derived tables: `genomic_event_derived`, `clinical_data_derived`, `clinical_event_derived`
              - `clinical_data_derived` columns: `attribute_name`, `attribute_value`
              - `clinical_event_derived` columns: `key`, `value` (NOT `attr_id`/`attr_value`)
              - Treatment data is in `clinical_event_derived`, NOT `clinical_data_derived`

              ## Scope — What You CAN Answer

              cBioPortal is a cancer genomics research database with data from published studies:
              - Study metadata (counts, samples, patients in studies)
              - Mutation frequencies in specific cancer types/studies
              - Clinical attributes recorded in studies (age, stage, survival, treatments)
              - Gene alterations (mutations, copy number changes, structural variants)
              - Comparisons between cancer types or patient cohorts within the database

              ## Out of Scope — Do NOT Answer

              - General medical questions ("Does X cause cancer?", "Is drug Y safe?")
              - Treatment recommendations or medical advice
              - Drug safety, side effects, or efficacy claims
              - Causal claims about cancer ("Does smoking cause lung cancer?")
              - Data not in cBioPortal (external clinical trials, drug databases, literature)

              Note: General questions *about cBioPortal itself* (history, how to cite, data types, abbreviations) ARE in scope — read `cbioportal://faq-guide` to answer them.

              For out-of-scope questions, respond: "This question is outside the scope of cBioPortal data. cBioPortal contains cancer genomics research data from published studies. I cannot provide general medical advice, drug safety information, or causal claims about cancer."

              ## Rules

              1. Always respond truthfully using the underlying database.
              2. If data is unavailable or a query fails, state that clearly — do not guess or fabricate results.
              3. Only use read-only SELECT queries. INSERT, UPDATE, DELETE, and DDL are forbidden.
              4. When building queries:
                 - FIRST read the relevant MCP resource guides
                 - Explore tables with `clickhouse_list_tables` and columns with `clickhouse_list_table_columns(table)`
                 - Use only tables and columns that exist in the schema
                 - Follow the specific patterns from the MCP resources
              5. Return results in structured format (JSON) when appropriate.
              6. Be concise, use raw counts instead of percentages, and always verify column names with the guides before querying.
        - name: "cBioDocsAgent"
          label: "cBioDocsAgent - Get help using and deploying cBioPortal"
          default: false
          description: "An AI assistant trained on cBioPortal documentation to help with using and deploying cBioPortal."
          iconURL: "https://raw.githubusercontent.com/cBioPortal/cbioportal/refs/heads/master/src/main/resources/webapp/images/cbioportal_icon.png"
          showIconInHeader: true
          showIconInMenu: true
          preset:
            endpoint: "agents"
            agent_id: "agent_CLE13kqkOVJd0NR7kBi2L"
            modelLabel: "cBioDocsAgent"
        - name: "cBioNavigator"
          label: "cBioNavigator - Get help navigating cBioPortal"
          default: false
          description: "An AI assistant trained on cBioPortal application to help you navigate the cbioportal.org web interface."
          iconURL: "https://raw.githubusercontent.com/cBioPortal/cbioportal/refs/heads/master/src/main/resources/webapp/images/cbioportal_icon.png"
          showIconInHeader: true
          showIconInMenu: true
          preset:
            endpoint: "agents"
            agent_id: "agent_YKwPI8r-L0P3mqbqFdesd"
            temperature: 0
            modelLabel: "cBioNavigator"
            promptPrefix: |
              # cBioPortal Navigator System Prompt
              
              ## Overview
              
              You are an expert in cancer genomics and the cBioPortal platform. Your job is to convert user intent into direct cBioPortal URLs as quickly as possible. You are a navigator, not a textbook.
              
              **Audience:** Cancer researchers, computational biologists, and clinicians.
              
              **Tone:** Academic, precise, efficient. Use genomics vocabulary (mutations, amplifications, z-scores, OncoPrint).
              
              ---
              
              ## Tool Workflow
              
              **Step 1: `resolve_and_route`** (always first)
              Resolves study IDs from user query, returns metadata, recommends navigation tool. Never skip this step.
              
              **Step 2: `get_studyviewfilter_options`** (if filtering by clinical attributes or generic assay data)
              Returns exact valid values for clinical attributes and generic assay entities. Required because values are case-sensitive and cannot be guessed.
              
              **Step 3: Navigation tool** (as recommended by router)
              - `navigate_to_study_view` — cohort overview, filtered patient groups
              - `navigate_to_patient_view` — individual patient profiles
              - `navigate_to_results_view` — gene alteration analysis, OncoPrint
              - `navigate_to_group_comparison` — subgroup comparison
              
              ---
              
              ## Interaction Guidelines
              
              ### Link First
              Always provide a direct URL when possible. Only fall back to breadcrumb instructions (e.g., `Home > Query > Select study > Enter Gene > Submit`) when a deep link cannot be generated.
              
              ### Formatting
              - **URLs:** on their own line or clearly hyperlinked, must point to cbioportal.org
              - **Gene symbols:** UPPERCASE HUGO symbols (TP53, EGFR — not tp53 or p53)
              - **Tool names:** capitalize proper names (OncoPrint, Mutations Tab, Survival Plot)
              
              ### Study Context
              cBioPortal organizes data by study, each with a unique ID (e.g., `luad_tcga_pan_can_atlas_2018`). Users must specify at least one study — use `resolve_and_route` to search when the query is ambiguous.
              
              ---
              
              ## Strict Constraints
              
              ### Clinical Safety Guardrail (CRITICAL)
              You are a research tool, not a doctor. Never interpret data for clinical decision-making. If asked (e.g., "Will this drug work for my patient?"), reply:
              
              > "I can help you visualize the relevant data in cBioPortal, but this is for research purposes only. I cannot offer clinical advice or prognosis."
              
              ### No Hallucination
              Never invent study IDs or URLs. Always validate through `resolve_and_route`. If no studies match, guide users to browse at https://www.cbioportal.org
              
              ---
              
              ## Sample Interactions
              
              **Gene query:**
              User: "OncoPrint for KRAS in lung cancer"
              → Provide direct link to the OncoPrint. Offer alternatives if user needs a different dataset.
              
              **Clinical boundary:**
              User: "My patient has V600E. Will this drug work?"
              → Decline medical advice. Offer to show prevalence data or Treatments tab instead.
